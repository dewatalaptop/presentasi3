<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <title>tokopintar.id - Professional POS</title>

    <style>
        /* === 1. DESIGN SYSTEM & RESET === */
        :root {
            --primary-500: #3b82f6; --primary-600: #2563eb;
            --neutral-0: #ffffff; --neutral-50: #f8fafc; --neutral-100: #f1f5f9; --neutral-200: #e2e8f0; --neutral-400: #94a3b8; --neutral-600: #475569; --neutral-800: #1e293b;
            --success-500: #10b981; --danger-500: #ef4444;
            --font-main: 'Inter', sans-serif;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: var(--font-main); }
        html { scroll-behavior: smooth; }
        body { background-color: var(--neutral-100); color: var(--neutral-800); -webkit-font-smoothing: antialiased; }
        ::selection { background-color: var(--primary-500); color: var(--neutral-0); }

        /* === 2. LAYOUT UTAMA (MOBILE-FIRST) === */
        .app-container { display: flex; }
        .main-content { width: 100%; padding: 15px; padding-bottom: 80px; /* Space for bottom nav */ transition: margin-left 0.3s ease; }
        .sidebar { display: none; } /* Hidden on mobile */
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; height: 65px; background-color: var(--neutral-0); border-top: 1px solid var(--neutral-200); display: flex; justify-content: space-around; z-index: 1000; }
        .bottom-nav-link { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; text-decoration: none; color: var(--neutral-400); gap: 4px; }
        .bottom-nav-link i { font-size: 20px; }
        .bottom-nav-link span { font-size: 10px; font-weight: 500; }
        .bottom-nav-link.active { color: var(--primary-500); }

        /* TABLET LAYOUT */
        @media (min-width: 768px) {
            .main-content { margin-left: 80px; width: calc(100% - 80px); padding: 20px; padding-bottom: 20px; }
            .sidebar { display: flex; flex-direction: column; position: fixed; width: 80px; height: 100vh; background-color: var(--neutral-0); border-right: 1px solid var(--neutral-200); padding: 20px 0; transition: width 0.3s ease; z-index: 1001; }
            .sidebar:hover { width: 250px; }
            .sidebar-header { display: flex; align-items: center; justify-content: center; padding: 0 10px; min-height: 40px; }
            .sidebar-header i { color: var(--primary-500); font-size: 28px; }
            .sidebar-header h2 { font-size: 22px; opacity: 0; visibility: hidden; white-space: nowrap; }
            .sidebar:hover .sidebar-header h2 { opacity: 1; visibility: visible; transition: opacity 0.3s ease 0.1s; }
            .sidebar-menu { list-style: none; margin-top: 30px; }
            .sidebar-menu a { display: flex; align-items: center; text-decoration: none; color: var(--neutral-600); padding: 15px 28px; white-space: nowrap; }
            .sidebar-menu a i { font-size: 22px; min-width: 24px; }
            .sidebar-menu a span { margin-left: 20px; font-weight: 500; opacity: 0; visibility: hidden; }
            .sidebar:hover .sidebar-menu a span { opacity: 1; visibility: visible; transition: opacity 0.3s ease 0.1s; }
            .sidebar-menu a:hover { background-color: var(--neutral-100); }
            .sidebar-menu a.active { color: var(--primary-500); font-weight: 600; position: relative; }
            .sidebar-menu a.active::before { content: ''; position: absolute; left: 0; top: 10px; bottom: 10px; width: 4px; background-color: var(--primary-500); border-radius: 0 4px 4px 0; }
            .bottom-nav { display: none; }
        }
        /* DESKTOP LAYOUT */
        @media (min-width: 1200px) {
            .main-content { margin-left: 250px; width: calc(100% - 250px); }
            .sidebar, .sidebar:hover { width: 250px; }
            .sidebar-header { justify-content: flex-start; padding: 0 25px; }
            .sidebar-header h2, .sidebar:hover .sidebar-header h2 { opacity: 1; visibility: visible; transition: none; }
            .sidebar-menu a span, .sidebar:hover .sidebar-menu a span { opacity: 1; visibility: visible; transition: none; }
        }

        /* === 3. KOMPONEN UI MODERN === */
        .page { display: none; animation: fadeIn 0.4s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .header h1 { font-size: 28px; }

        .card { background-color: var(--neutral-0); border: 1px solid var(--neutral-200); border-radius: 12px; padding: 25px; margin-bottom: 20px; }
        
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 8px; padding: 10px 18px; border-radius: 8px; font-weight: 600; text-decoration: none; cursor: pointer; border: 1px solid transparent; transition: all 0.2s ease; }
        .btn:active { transform: scale(0.98); }
        .btn-primary { background-color: var(--primary-500); color: var(--neutral-0); }
        .btn-primary:hover { background-color: var(--primary-600); }
        .btn-secondary { background-color: var(--neutral-0); color: var(--neutral-800); border-color: var(--neutral-200); }
        .btn-secondary:hover { background-color: var(--neutral-50); }
        .btn-text { background: none; color: var(--primary-500); }
        .btn-text:hover { background-color: var(--neutral-100); }
        
        .form-group { position: relative; margin-bottom: 25px; }
        .form-input { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid var(--neutral-200); font-size: 16px; }
        .form-input:focus { border-color: var(--primary-500); outline: none; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2); }
        .form-label { position: absolute; left: 12px; top: 12px; font-size: 16px; color: var(--neutral-400); background-color: var(--neutral-0); padding: 0 4px; transition: all 0.2s ease; pointer-events: none; }
        .form-input:not(:placeholder-shown) + .form-label, .form-input:focus + .form-label { top: -10px; font-size: 12px; color: var(--primary-500); }
        
        .modal { position: fixed; inset: 0; background-color: rgba(30, 41, 59, 0.5); z-index: 2000; display: none; justify-content: center; align-items: center; animation: fadeIn 0.2s ease; }
        .modal-content { background-color: var(--neutral-0); border-radius: 12px; padding: 25px; min-width: 300px; max-width: 90vw; box-shadow: var(--shadow-md); animation: scaleIn 0.3s ease; }
        @keyframes scaleIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .modal-header h2 { font-size: 20px; }
        .close-modal { background: none; border: none; font-size: 24px; cursor: pointer; color: var(--neutral-400); }

        #toast-container { position: fixed; bottom: 20px; right: 20px; z-index: 3000; }
        .toast { padding: 15px 20px; border-radius: 8px; color: var(--neutral-0); margin-top: 10px; box-shadow: var(--shadow-md); animation: slideIn 0.3s ease; }
        .toast.success { background-color: var(--success-500); }
        .toast.error { background-color: var(--danger-500); }
        @keyframes slideIn { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }

        /* === 4. TAMPILAN SPESIFIK HALAMAN === */
        /* Kasir */
        .kasir-container { display: grid; grid-template-columns: 1fr; gap: 20px; height: calc(100vh - 150px); }
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 15px; overflow-y: auto; }
        .product-card { border: 1px solid var(--neutral-200); border-radius: 8px; cursor: pointer; transition: all 0.2s ease; }
        .product-card:hover { transform: translateY(-5px); box-shadow: var(--shadow-md); }
        .product-card img { width: 100%; height: 100px; object-fit: cover; border-radius: 8px 8px 0 0; }
        .product-card-info { padding: 10px; }
        .product-card-info h4 { font-size: 14px; font-weight: 600; }
        .product-card-info p { font-size: 12px; color: var(--primary-500); font-weight: 500; }
        #cart-summary-bar { position: fixed; bottom: 65px; left: 0; right: 0; background-color: var(--primary-500); color: var(--neutral-0); padding: 15px; display: none; justify-content: space-between; align-items: center; cursor: pointer; animation: slideUp 0.3s ease; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        
        @media (min-width: 1200px) {
            .kasir-container { grid-template-columns: 2fr 1.2fr; }
            .cart-container { display: flex !important; flex-direction: column; }
            #cart-summary-bar { display: none !important; }
        }

        /* Tabel Responsif */
        .responsive-table { width: 100%; }
        @media (max-width: 767px) {
            .responsive-table thead { display: none; }
            .responsive-table tr { display: block; background: var(--neutral-0); border: 1px solid var(--neutral-200); border-radius: 8px; margin-bottom: 15px; padding: 15px; }
            .responsive-table td { display: flex; justify-content: space-between; align-items: center; text-align: right; }
            .responsive-table td::before { content: attr(data-label); font-weight: 600; text-align: left; margin-right: 15px; }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <nav class="sidebar">
            <div class="sidebar-header">
                <i class="fa-solid fa-bolt"></i>
                <h2 id="store-name-sidebar"></h2>
            </div>
            <ul class="sidebar-menu"></ul>
        </nav>

        <main class="main-content">
            <header class="header">
                <h1 id="page-title"></h1>
                <div id="clock"></div>
            </header>
            <div id="page-content"></div>
        </main>

        <nav class="bottom-nav"></nav>
        
        <div id="modal-container"></div>
        <div id="toast-container"></div>
    </div>

<script>
// --- APLIKASI POS PROFESIONAL (SINGLE-FILE) ---
// Ditulis ulang dengan Bug Fix & Desain Ulang Total
document.addEventListener('DOMContentLoaded', () => {
    const App = {
        // === 1. STATE & INISIALISASI ===
        state: { 
            currentPage: 'dashboard', 
            currentUserRole: 'admin', 
            cart: [], products: [], customers: [], transactions: [], expenses: [], stockHistory: [],
            settings: {}
        },
        elements: {},
        
        init() {
            this.initData();
            this.injectBaseHTML();
            this.cacheDOMElements();
            this.applySettings();
            this.attachEventListeners();
            this.updateClock();
            setInterval(() => this.updateClock(), 1000);
            this.showPage('dashboard');
        },

        initData() {
            const defaultSettings = { namaToko: 'tokopintar.id', alamatToko: 'Jl. Digital No. 1, Semarang', pesanDiStruk: 'Terima kasih telah berbelanja!' };
            try {
                this.state.settings = this.getFromLocalStorage('settings', defaultSettings);
                this.state.products = this.getFromLocalStorage('products', [ { id: 1, name: 'Kopi Susu Gula Aren', category: 'Kopi', price: 18000, stock: 50 }, { id: 2, name: 'Croissant Coklat', category: 'Roti', price: 22000, stock: 30 } ]);
                this.state.customers = this.getFromLocalStorage('customers', []);
                this.state.transactions = this.getFromLocalStorage('transactions', []);
                this.state.expenses = this.getFromLocalStorage('expenses', []);
                this.state.stockHistory = this.getFromLocalStorage('stockHistory', []);
                this.state.cart = this.getFromLocalStorage('cart', []);
            } catch (e) {
                console.error("Gagal memuat data dari localStorage:", e);
                if (confirm("Data aplikasi tampaknya rusak. Apakah Anda ingin mereset ke pengaturan awal? Data yang ada akan hilang.")) {
                    localStorage.clear();
                    this.initData(); // Coba lagi dengan data default
                }
            }
            this.saveAllData();
        },

        injectBaseHTML() {
            const menuItems = [
                { id: 'dashboard', icon: 'fa-solid fa-chart-pie', label: 'Dashboard', role: 'all' },
                { id: 'kasir', icon: 'fa-solid fa-cash-register', label: 'Kasir', role: 'all' },
                { id: 'produk', icon: 'fa-solid fa-box-open', label: 'Produk', role: 'admin' },
                { id: 'laporan', icon: 'fa-solid fa-chart-line', label: 'Laporan', role: 'admin' },
                { id: 'lainnya', icon: 'fa-solid fa-ellipsis', label: 'Lainnya', role: 'all', mobileOnly: true },
                { id: 'pelanggan', icon: 'fa-solid fa-users', label: 'Pelanggan', role: 'admin', desktopOnly: true },
                { id: 'biaya', icon: 'fa-solid fa-wallet', label: 'Biaya', role: 'admin', desktopOnly: true },
                { id: 'pengaturan', icon: 'fa-solid fa-gear', label: 'Pengaturan', role: 'admin', desktopOnly: true }
            ];
            
            let sidebarHTML = '';
            menuItems.filter(item => !item.mobileOnly).forEach(item => {
                sidebarHTML += `<li data-role="${item.role}"><a href="#" class="nav-link" data-page="${item.id}"><i class="${item.icon}"></i><span>${item.label}</span></a></li>`;
            });
            document.querySelector('.sidebar-menu').innerHTML = sidebarHTML;

            let bottomNavHTML = '';
            menuItems.filter(item => !item.desktopOnly).forEach(item => {
                bottomNavHTML += `<a href="#" class="bottom-nav-link nav-link" data-page="${item.id}" data-role="${item.role}"><i class="${item.icon}"></i><span>${item.label}</span></a>`;
            });
            document.querySelector('.bottom-nav').innerHTML = bottomNavHTML;
        },

        cacheDOMElements() {
            this.elements = {
                pageTitle: document.getElementById('page-title'), clock: document.getElementById('clock'),
                pageContent: document.getElementById('page-content'), modalContainer: document.getElementById('modal-container'),
                toastContainer: document.getElementById('toast-container'), navLinks: document.querySelectorAll('.nav-link'),
                sidebarStoreName: document.getElementById('store-name-sidebar'),
            };
        },
        
        attachEventListeners() {
            this.elements.navLinks.forEach(link => link.addEventListener('click', e => { e.preventDefault(); this.showPage(e.currentTarget.dataset.page); }));
            document.addEventListener('keydown', e => { if (e.key === 'Escape') this.closeModal(); });
            document.addEventListener('keydown', e => { 
                if ((e.ctrlKey || e.metaKey) && e.key === 'k') { e.preventDefault(); this.showToast('Command Palette belum tersedia.', 'error'); }
                const currentPage = this.state.currentPage;
                if (currentPage === 'kasir') {
                    if (e.key === 'F1') { e.preventDefault(); document.getElementById('kasir-search-input')?.focus(); }
                    if (e.key === 'F9') { e.preventDefault(); this.openPaymentModal(); }
                }
            });
        },
        
        // === 2. UTILITIES ===
        saveAllData() { for (const key in this.state) { this.saveToLocalStorage(key, this.state[key]); } },
        getFromLocalStorage(key, defaultValue) { const data = localStorage.getItem(key); if (!data) return defaultValue; try { return JSON.parse(data); } catch { return defaultValue; } },
        saveToLocalStorage: (key, data) => localStorage.setItem(key, JSON.stringify(data)),
        formatRupiah: (number) => new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(number),
        updateClock() { this.elements.clock.textContent = new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' }); },
        applySettings() { document.title = `${this.state.settings.namaToko} - POS`; this.elements.sidebarStoreName.textContent = this.state.settings.namaToko; },

        showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            this.elements.toastContainer.appendChild(toast);
            setTimeout(() => { toast.remove(); }, 3000);
        },

        showModal(title, contentHTML, onConfirm, confirmText = 'Simpan') {
            this.elements.modalContainer.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header"><h2>${title}</h2><button class="close-modal">&times;</button></div>
                    <form id="modal-form">${contentHTML}</form>
                    <div style="text-align:right; margin-top:20px;">
                        <button class="btn btn-secondary close-modal">Batal</button>
                        <button class="btn btn-primary" id="modal-confirm">${confirmText}</button>
                    </div>
                </div>`;
            this.elements.modalContainer.style.display = 'flex';
            document.querySelector('#modal-confirm').addEventListener('click', () => { if(onConfirm()) this.closeModal(); });
            this.elements.modalContainer.querySelectorAll('.close-modal').forEach(el => el.addEventListener('click', () => this.closeModal()));
        },
        closeModal() { this.elements.modalContainer.style.display = 'none'; },

        // === 3. NAVIGASI & RENDER HALAMAN ===
        showPage(pageId) {
            this.elements.navLinks.forEach(l => l.classList.remove('active'));
            document.querySelectorAll(`.nav-link[data-page="${pageId}"]`).forEach(l => l.classList.add('active'));
            this.state.currentPage = pageId;
            const pageData = {
                dashboard: { title: 'Dashboard', render: this.renderDashboard },
                kasir: { title: 'Kasir', render: this.renderKasir },
                produk: { title: 'Produk', render: this.renderProduk },
                laporan: { title: 'Laporan', render: this.renderLaporan },
                // ... dan seterusnya
            };
            this.elements.pageTitle.textContent = pageData[pageId]?.title || 'Lainnya';
            this.elements.pageContent.innerHTML = '';
            pageData[pageId]?.render.call(this);
        },
        
        // === 4. FUNGSI PER MODUL ===
        
        // --- KASIR ---
        renderKasir() {
            this.elements.pageContent.innerHTML = `<div class="kasir-container"><div class="card product-section"><div class="card-header"><input type="text" id="kasir-search-input" class="form-input" placeholder="Cari produk (F1)..."></div><div id="product-grid" class="product-grid"></div></div><div id="cart-container" class="card cart-container" style="display:none;"><h3 style="margin-bottom:15px;">Keranjang</h3><div id="cart-items"></div><div id="cart-total" style="margin-top:auto; padding-top:15px; border-top:1px solid var(--neutral-200);"></div><button id="btn-bayar" class="btn btn-primary" style="width:100%; margin-top:15px;">Bayar (F9)</button></div></div><div id="cart-summary-bar"></div>`;
            document.getElementById('kasir-search-input').addEventListener('input', e => this.renderProductGrid(e.target.value));
            document.getElementById('product-grid').addEventListener('click', e => { const card = e.target.closest('.product-card'); if (card) this.addToCart(parseInt(card.dataset.id)); });
            document.getElementById('btn-bayar').addEventListener('click', () => this.openPaymentModal());
            document.getElementById('cart-summary-bar').addEventListener('click', () => this.showModal('Keranjang', document.getElementById('cart-container').innerHTML, null)); // Placeholder
            this.renderProductGrid();
            this.renderCart();
        },
        renderProductGrid(searchTerm = '') {
            const container = document.getElementById('product-grid');
            const normalizedSearch = searchTerm.toLowerCase();
            const products = this.state.products.filter(p => p.name.toLowerCase().includes(normalizedSearch));
            container.innerHTML = products.map(p => `
                <div class="product-card" data-id="${p.id}">
                    <img src="https://via.placeholder.com/150/e2e8f0/475569?text=${p.name.charAt(0)}" alt="${p.name}">
                    <div class="product-card-info"><h4>${p.name}</h4><p>${this.formatRupiah(p.price)}</p></div>
                </div>`).join('');
        },
        addToCart(productId) { 
            const product = this.state.products.find(p => p.id === productId);
            if(product.stock <= 0) return this.showToast('Stok produk habis!', 'error');
            const itemInCart = this.state.cart.find(i => i.id === productId);
            if(itemInCart) {
                if(itemInCart.quantity >= product.stock) return this.showToast('Jumlah melebihi stok!', 'error');
                itemInCart.quantity++;
            } else {
                this.state.cart.push({ ...product, quantity: 1 });
            }
            this.saveToLocalStorage('cart', this.state.cart);
            this.renderCart();
        },
        renderCart() {
            const container = document.getElementById('cart-items');
            if(!container) return;
            const subtotal = this.state.cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
            container.innerHTML = this.state.cart.length ? this.state.cart.map(item => `<div>${item.name} x ${item.quantity}</div>`).join('') : `<i>Keranjang kosong</i>`;
            document.getElementById('cart-total').innerHTML = `<strong>Total: ${this.formatRupiah(subtotal)}</strong>`;

            // Mobile summary bar
            const summaryBar = document.getElementById('cart-summary-bar');
            if(this.state.cart.length > 0) {
                summaryBar.style.display = 'flex';
                summaryBar.innerHTML = `<span>${this.state.cart.length} item</span><strong>${this.formatRupiah(subtotal)}</strong>`;
            } else {
                summaryBar.style.display = 'none';
            }
        },
        openPaymentModal() {
            if (this.state.cart.length === 0) return this.showToast('Keranjang kosong!', 'error');
            const subtotal = this.state.cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
            this.showModal('Pembayaran', `<div>Total: ${this.formatRupiah(subtotal)}</div>`, () => this.processPayment());
        },
        processPayment() {
            // Placeholder simple payment
            this.state.cart.forEach(cartItem => {
                const product = this.state.products.find(p => p.id === cartItem.id);
                if(product) product.stock -= cartItem.quantity;
            });
            const newTransaction = { id: 'TRX-' + Date.now(), date: new Date().toISOString(), items: this.state.cart, finalTotal: this.state.cart.reduce((s,i)=>s+(i.price*i.quantity),0) };
            this.state.transactions.push(newTransaction);
            this.state.cart = [];
            this.saveAllData();
            this.showToast('Transaksi berhasil!');
            this.renderKasir(); // Re-render kasir
            return true;
        },

        // --- PRODUK ---
        renderProduk() {
            this.elements.pageContent.innerHTML = `<div class="header"><h1>Produk</h1><button class="btn btn-primary" id="btn-add-product">Tambah Produk</button></div><div id="product-table-container"></div>`;
            document.getElementById('btn-add-product').addEventListener('click', () => this.showProductModal());
            this.renderProductTable();
        },
        renderProductTable() {
            let tableHTML = `<table class="responsive-table"><thead><tr><th>Nama</th><th>Kategori</th><th>Harga</th><th>Stok</th><th>Aksi</th></tr></thead><tbody>`;
            this.state.products.forEach(p => {
                tableHTML += `
                    <tr>
                        <td data-label="Nama">${p.name}</td><td data-label="Kategori">${p.category}</td>
                        <td data-label="Harga">${this.formatRupiah(p.price)}</td><td data-label="Stok">${p.stock}</td>
                        <td data-label="Aksi"><button class="btn btn-text" onclick="App.showProductModal(${p.id})">Edit</button></td>
                    </tr>`;
            });
            tableHTML += `</tbody></table>`;
            document.getElementById('product-table-container').innerHTML = tableHTML;
        },
        showProductModal(productId) {
            const isEdit = productId !== undefined;
            const product = isEdit ? this.state.products.find(p => p.id === productId) : {};
            const title = isEdit ? 'Edit Produk' : 'Tambah Produk';
            const content = `
                <div class="form-group"><input type="text" id="p-name" class="form-input" placeholder=" " value="${product.name || ''}" required><label class="form-label">Nama Produk</label></div>
                <div class="form-group"><input type="text" id="p-category" class="form-input" placeholder=" " value="${product.category || ''}" required><label class="form-label">Kategori</label></div>
                <div class="form-group"><input type="number" id="p-price" class="form-input" placeholder=" " value="${product.price || ''}" required><label class="form-label">Harga</label></div>
                <div class="form-group"><input type="number" id="p-stock" class="form-input" placeholder=" " value="${product.stock || ''}" required><label class="form-label">Stok</label></div>
            `;
            this.showModal(title, content, () => this.saveProduct(productId));
        },
        saveProduct(productId) {
            const name = document.getElementById('p-name').value.trim();
            const price = parseFloat(document.getElementById('p-price').value);
            const stock = parseInt(document.getElementById('p-stock').value);

            if (!name || price <= 0 || stock < 0) {
                this.showToast('Data tidak valid!', 'error');
                return false;
            }

            if (productId !== undefined) { // Edit Mode
                const product = this.state.products.find(p => p.id === productId);
                Object.assign(product, { name, category: document.getElementById('p-category').value, price, stock });
            } else { // Add Mode
                const newId = (Math.max(0, ...this.state.products.map(p => p.id)) + 1);
                this.state.products.push({ id: newId, name, category: document.getElementById('p-category').value, price, stock });
            }
            this.saveAllData();
            this.renderProductTable();
            return true;
        },

        // Placeholder untuk render Halaman lain
        renderLaporan() { this.elements.pageContent.innerHTML = `<div class="card">Fitur Laporan sedang dikembangkan.</div>`; },
    };

    // Public API for inline onclick handlers
    window.App = {
        showProductModal: App.showProductModal.bind(App),
    };
    
    App.init();
});
</script>
</body>
</html>
